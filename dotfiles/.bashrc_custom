# SET UP SOME COMMON ALIASES
if ! which vim &> /dev/null;then
  alias vim="vi"
fi
#Mac specific aliases
if uname -rms | grep Darwin &> /dev/null;then
  alias flushdns='dscacheutil -flushcache'
  alias l.='ls -Gd .*'
  alias ll='ls -Gl'
  alias ls='ls -G'
  alias g=/usr/local/bin/git
  alias git=/usr/local/bin/git
  export PATH="${PATH}:/usr/local/sbin"
else
  #aliases that don't work on Mac
  alias l.='ls -d .* --color=auto'
  alias ll='ls -l --color=auto'
  alias ls='ls --color=auto'
  alias g='git'
fi
alias rspec='rspec --color --format nested'
#alias ...='while read line; do echo -n "."; done && echo ""'
alias ...='spinner.py'
alias x='exit'
#run last command as sudo
alias please='sudo $(history -p !!)'
alias ..2='cd ../../'
alias ..3='cd ../../../'
alias ..4='cd ../../../../'
alias ..5='cd ../../../../../'
alias socks='ssh -ND 1080'

# ENVIRONMENT VARIABLES
if echo "${PATH}" | grep -v "~/bin" &> /dev/null;then
  export PATH="~/bin:${PATH}"
fi
# happy face if last command successful or sadface if last command failed
export PS1="\`if [ \$? = 0 ]; then echo \[\e[33m\]^_^\[\e[0m\]; else echo \[\e[31m\]O_O\[\e[0m\]; fi\`[\u@\h:\w]\\$ "
export EDITOR="vim"
if [ ! -z "${SUDO_USER}" -a "$(id -u)" -eq "0" ];then
  export HOME="/root"
  export HISTFILE="$HOME/.bash_history"
  export MAIL="/var/spool/mail/root"
fi
export HISTIGNORE="&:ls:[bf]g:exit:history:history2"
export HISTCONTROL="ignorespace:ignoredups:&:ls:[bf]g:exit:history:history2"
export HISTFILESIZE=5000
export HISTSIZE=5000
#preserve all bash history
if [ ! -d "${HOME}/.bash_history_dir" ]; then
  mkdir "${HOME}/.bash_history_dir"
fi
export HISTFILE="${HOME}/.bash_history_dir/bash_history_$(date +%Y-%m-%d-%s)"
function history2() {
  ls -1tr ~/.bash_history_dir/ | xargs -I '{}' cat "${HOME}/.bash_history_dir/{}"
  #grep -r '.*' ~/.bash_cmd_history/ | python -c 'import sys;map(lambda x: sys.stdout.write(x.split(":",1)[1]),sys.stdin.readlines())'
}

# SHELL OPTIONS
shopt -s cmdhist
set -o vi

#
# setup ssh-agent
#
# set environment variables if user's agent already exists
SSH_AUTH_SOCK=$(ls -l /tmp/ssh-*/agent.* 2> /dev/null | grep $(whoami) | awk '{print $9}')
SSH_AGENT_PID=$(echo $SSH_AUTH_SOCK | cut -d. -f2)
[ -n "$SSH_AUTH_SOCK" ] && export SSH_AUTH_SOCK
[ -n "$SSH_AGENT_PID" ] && export SSH_AGENT_PID
